<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizard's Guild | Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        #app {
            max-width: 100%;
        }
        
        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        #loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        
        .loader {
            text-align: center;
        }
        
        .crystal {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background: linear-gradient(45deg, #8a2be2, #00bfff);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        #main-ui {
            display: none;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .top-bar {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .player-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .mana-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .mana-icon {
            color: #00bfff;
            animation: sparkle 3s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .nav-btn.active {
            background: rgba(0, 191, 255, 0.3);
            transform: scale(1.1);
        }
        
        .nav-btn:active {
            transform: scale(0.95);
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        #content {
            padding: 20px 15px;
            min-height: calc(100vh - 100px);
        }
        
        /* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–∞—à–Ω–∏ */
        .tower-page {
            text-align: center;
        }
        
        .tap-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 25px;
            padding: 40px 20px;
            margin: 20px 0;
            border: 2px dashed rgba(0, 191, 255, 0.3);
            cursor: pointer;
            touch-action: manipulation;
            transition: transform 0.1s;
        }
        
        .tap-area:active {
            background: rgba(0, 191, 255, 0.1);
            transform: scale(0.98);
        }
        
        .wizard-avatar {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            background: linear-gradient(45deg, #8a2be2, #00bfff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: linear-gradient(45deg, #8a2be2, #00bfff);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
            width: 100%;
            transition: all 0.2s;
        }
        
        .btn:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        /* –§–ª–æ–∞—Ç–∏–Ω–≥–∏ */
        .floating-text {
            position: fixed;
            color: #00bfff;
            font-weight: bold;
            font-size: 24px;
            pointer-events: none;
            z-index: 1000;
            text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
            animation: floatUp 1s ease-out forwards;
            left: 50%;
            top: 40%;
            transform: translateX(-50%);
        }
        
        @keyframes floatUp {
            0% {
                transform: translateY(0) translateX(-50%);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(-50%);
                opacity: 0;
            }
        }
        
        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º */
        .show {
            display: block !important;
        }
        
        .hide {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
        <div id="loading">
            <div class="loader">
                <div class="crystal"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞–≥–∏–∏...</p>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
        <div id="main-ui" class="hide">
            <nav class="top-bar">
                <div class="player-info">
                    <span id="player-name">–ú–∞–≥</span>
                    <div class="mana-display">
                        <span class="mana-icon">‚ú®</span>
                        <span id="mana-count">100</span>
                    </div>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="loadPage('tower')">üè∞</button>
                    <button class="nav-btn" onclick="loadPage('spells')">üìñ</button>
                    <button class="nav-btn" onclick="loadPage('duel')">‚öîÔ∏è</button>
                    <button class="nav-btn" onclick="loadPage('guild')">üë•</button>
                </div>
            </nav>
            
            <div id="content">
                <!-- –°—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—é–¥–∞ -->
            </div>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        const CONFIG = {
            BASE_MANA_PER_TAP: 10,
            DAILY_COMBO_REWARD: 500
        };
        
        // ========== –ò–ì–†–û–í–´–ï –î–ê–ù–ù–´–ï ==========
        let gameData = {
            mana: 100,
            level: 1,
            spells: ['fireball'],
            lastTap: 0
        };
        
        // ========== TELEGRAM ==========
        let tg = null;
        let user = null;
        
        function initTelegram() {
            if (window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                tg.expand();
                user = tg.initDataUnsafe.user;
                
                if (user && user.first_name) {
                    document.getElementById('player-name').textContent = user.first_name;
                }
                
                console.log('Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);
            } else {
                console.log('–î–µ–º–æ-—Ä–µ–∂–∏–º (–Ω–µ –≤ Telegram)');
                user = { id: 123456, first_name: "–¢–µ—Å—Ç–æ–≤—ã–π", username: "test" };
            }
        }
        
        // ========== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ==========
        function tap() {
            const now = Date.now();
            if (now - gameData.lastTap < 100) return 0;
            
            gameData.mana += CONFIG.BASE_MANA_PER_TAP;
            gameData.lastTap = now;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            showFloatingText(`+${CONFIG.BASE_MANA_PER_TAP}`);
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            saveGame();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            updateManaDisplay();
            
            return CONFIG.BASE_MANA_PER_TAP;
        }
        
        function useDailyCombo(combo) {
            if (combo.toUpperCase().includes('ALT+MANA')) {
                gameData.mana += CONFIG.DAILY_COMBO_REWARD;
                saveGame();
                updateManaDisplay();
                showAlert(`üéâ +${CONFIG.DAILY_COMBO_REWARD} –º–∞–Ω—ã!`);
                return true;
            }
            showAlert("–ù–µ–≤–µ—Ä–Ω–æ–µ –∫–æ–º–±–æ! –ü–æ–ø—Ä–æ–±—É–π ALT+MANA");
            return false;
        }
        
        // ========== UI –§–£–ù–ö–¶–ò–ò ==========
        function loadPage(page) {
            console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É:', page);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º active –Ω–∞ –Ω—É–∂–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.nav-btn').forEach(btn => {
                if (btn.textContent.includes(getButtonEmoji(page))) {
                    btn.classList.add('active');
                }
            });
            
            const content = document.getElementById('content');
            
            switch(page) {
                case 'tower':
                    content.innerHTML = getTowerPage();
                    setupTowerEvents();
                    break;
                    
                case 'spells':
                    content.innerHTML = getSpellsPage();
                    break;
                    
                case 'duel':
                    content.innerHTML = getDuelPage();
                    break;
                    
                case 'guild':
                    content.innerHTML = getGuildPage();
                    break;
            }
        }
        
        function getTowerPage() {
            return `
                <div class="tower-page">
                    <h2>üè∞ –ú–∞–≥–∏—á–µ—Å–∫–∞—è –ë–∞—à–Ω—è</h2>
                    <p>–£—Ä–æ–≤–µ–Ω—å: <strong>${gameData.level}</strong></p>
                    
                    <div class="tap-area" id="tap-area">
                        <div class="wizard-avatar">
                            üßô
                        </div>
                        <p>–¢–∞–ø–∞–π –ø–æ –º–∞–≥—É –¥–ª—è —Å–±–æ—Ä–∞ –º–∞–Ω—ã!</p>
                        <p style="color: #00bfff; font-size: 14px;">
                            +${CONFIG.BASE_MANA_PER_TAP} –º–∞–Ω—ã –∑–∞ —Ç–∞–ø
                        </p>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 15px; margin: 20px 0;">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <p>‚Ä¢ –ú–∞–Ω—É –º–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è</p>
                        <p>‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–æ–º–±–æ</p>
                        <p>‚Ä¢ –£—á–∞—Å—Ç–≤—É–π –≤ –¥—É—ç–ª—è—Ö</p>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                        <h3>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∫–æ–º–±–æ</h3>
                        <input type="text" 
                               id="combo-input" 
                               placeholder="–í–≤–µ–¥–∏ ALT+MANA"
                               style="width: 100%; padding: 12px; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white; margin-bottom: 10px;">
                        <button class="btn" id="combo-btn">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–±–æ</button>
                        <p style="font-size: 13px; color: rgba(255,255,255,0.6); margin-top: 10px;">
                            –î–∞–µ—Ç +${CONFIG.DAILY_COMBO_REWARD} –º–∞–Ω—ã —Ä–∞–∑ –≤ –¥–µ–Ω—å
                        </p>
                    </div>
                </div>
            `;
        }
        
        function getSpellsPage() {
            return `
                <div style="text-align: center; padding: 20px;">
                    <h2>üìñ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è</h2>
                    <p style="margin: 20px 0;">–ó–¥–µ—Å—å –±—É–¥—É—Ç —Ç–≤–æ–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è</p>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                        <div style="font-size: 40px;">üî•</div>
                        <h3>–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä</h3>
                        <p>–ò–∑—É—á–µ–Ω–æ</p>
                    </div>
                    <button class="btn" onclick="loadPage('tower')">‚Üê –ù–∞–∑–∞–¥ –≤ –±–∞—à–Ω—é</button>
                </div>
            `;
        }
        
        function getDuelPage() {
            return `
                <div style="text-align: center; padding: 20px;">
                    <h2>‚öîÔ∏è –î—É—ç–ª–∏</h2>
                    <p style="margin: 20px 0;">–°—Ä–∞–∂–∞–π—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –º–∞–≥–∞–º–∏</p>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                        <p>–ü–æ–±–µ–¥: <strong>0</strong></p>
                        <p>–ü–æ—Ä–∞–∂–µ–Ω–∏–π: <strong>0</strong></p>
                        <p>–†–µ–π—Ç–∏–Ω–≥: <strong>1000</strong></p>
                    </div>
                    <button class="btn" onclick="startDuel()">–ù–∞—á–∞—Ç—å –¥—É—ç–ª—å (50 –º–∞–Ω—ã)</button>
                    <button class="btn" onclick="loadPage('tower')" style="background: rgba(255,255,255,0.1);">‚Üê –ù–∞–∑–∞–¥</button>
                </div>
            `;
        }
        
        function getGuildPage() {
            return `
                <div style="text-align: center; padding: 20px;">
                    <h2>üë• –ì–∏–ª—å–¥–∏—è</h2>
                    <p style="margin: 20px 0;">–û–±—ä–µ–¥–∏–Ω—è–π—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –º–∞–≥–∞–º–∏</p>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
                        <p>–¢—ã –ø–æ–∫–∞ –æ–¥–∏–Ω–æ–∫–∏–π –º–∞–≥</p>
                        <p>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –≥–∏–ª—å–¥–∏—é!</p>
                    </div>
                    <button class="btn" onclick="loadPage('tower')">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–∞—à–Ω—é</button>
                </div>
            `;
        }
        
        function getButtonEmoji(page) {
            const emojis = {
                'tower': 'üè∞',
                'spells': 'üìñ', 
                'duel': '‚öîÔ∏è',
                'guild': 'üë•'
            };
            return emojis[page] || 'üè∞';
        }
        
        function setupTowerEvents() {
            // –¢–∞–ø –ø–æ –º–∞–≥—É
            const tapArea = document.getElementById('tap-area');
            if (tapArea) {
                tapArea.onclick = function() {
                    tap();
                    // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 100);
                };
                
                // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
                tapArea.ontouchstart = function(e) {
                    e.preventDefault();
                    tap();
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 100);
                };
            }
            
            // –ö–Ω–æ–ø–∫–∞ –∫–æ–º–±–æ
            const comboBtn = document.getElementById('combo-btn');
            const comboInput = document.getElementById('combo-input');
            
            if (comboBtn) {
                comboBtn.onclick = function() {
                    if (comboInput.value.trim()) {
                        useDailyCombo(comboInput.value.trim());
                        comboInput.value = '';
                    } else {
                        showAlert("–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–±–æ!");
                    }
                };
            }
        }
        
        function showFloatingText(text) {
            const floatText = document.createElement('div');
            floatText.className = 'floating-text';
            floatText.textContent = text;
            
            document.body.appendChild(floatText);
            
            setTimeout(() => {
                if (floatText.parentNode) {
                    floatText.parentNode.removeChild(floatText);
                }
            }, 1000);
        }
        
        function updateManaDisplay() {
            const manaElement = document.getElementById('mana-count');
            if (manaElement) {
                manaElement.textContent = gameData.mana;
            }
        }
        
        function showAlert(message) {
            if (tg && tg.showAlert) {
                tg.showAlert(message);
            } else {
                alert(message);
            }
        }
        
        function saveGame() {
            const userId = user ? user.id : 'demo';
            localStorage.setItem(`wizard_${userId}`, JSON.stringify(gameData));
        }
        
        function loadGame() {
            const userId = user ? user.id : 'demo';
            const saved = localStorage.getItem(`wizard_${userId}`);
            
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    gameData = { ...gameData, ...data };
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                }
            }
            
            updateManaDisplay();
        }
        
        // ========== –ó–ê–ü–£–°–ö –ò–ì–†–´ ==========
        function startGame() {
            console.log('–ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
            initTelegram();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            loadGame();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('loading').classList.add('hide');
            document.getElementById('main-ui').classList.remove('hide');
            document.getElementById('main-ui').classList.add('show');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            loadPage('tower');
            
            console.log('–ò–≥—Ä–∞ –∑–∞–ø—É—â–µ–Ω–∞!');
        }
        
        // ========== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function startDuel() {
            if (gameData.mana < 50) {
                showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞–Ω—ã –¥–ª—è –¥—É—ç–ª–∏!");
                return;
            }
            
            gameData.mana -= 50;
            
            // –°–ª—É—á–∞–π–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const win = Math.random() > 0.5;
            
            if (win) {
                gameData.mana += 100;
                showAlert("üèÜ –ü–æ–±–µ–¥–∞! +100 –º–∞–Ω—ã");
            } else {
                showAlert("üí• –ü–æ—Ä–∞–∂–µ–Ω–∏–µ... –ú–∞–Ω–∞ –ø–æ—Ç—Ä–∞—á–µ–Ω–∞");
            }
            
            saveGame();
            updateManaDisplay();
        }
        
        // ========== –ó–ê–ü–£–°–ö –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ==========
        window.onload = function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(startGame, 500);
        };
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –¥–ª—è onclick
        window.loadPage = loadPage;
        window.startDuel = startDuel;
    </script>
</body>
</html>
