<style>
    :root {
        --primary: #8a2be2;
        --secondary: #00bfff;
        --accent: #ff416c;
        --dark: #1a1a2e;
        --darker: #0f0f1e;
        --light: #ffffff;
        --success: #00ff88;
        --warning: #ffd700;
        --danger: #ff416c;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    body {
        background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
        color: var(--light);
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 80%, rgba(138, 43, 226, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(0, 191, 255, 0.1) 0%, transparent 50%);
        z-index: -1;
        animation: backgroundShift 20s ease-in-out infinite alternate;
    }
    
    @keyframes backgroundShift {
        0% { transform: translate(0, 0) scale(1); }
        100% { transform: translate(-50px, 50px) scale(1.1); }
    }
    
    #app {
        max-width: 500px;
        margin: 0 auto;
        position: relative;
        min-height: 100vh;
        overflow: hidden;
    }
    
    /* Загрузка */
    #loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--darker);
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 1000;
        transition: opacity 0.5s ease-out;
    }
    
    .loader {
        text-align: center;
        position: relative;
    }
    
    .crystal {
        width: 80px;
        height: 80px;
        margin: 0 auto 25px;
        background: linear-gradient(45deg, var(--primary), var(--secondary));
        border-radius: 20px;
        position: relative;
        animation: crystalFloat 3s ease-in-out infinite, crystalGlow 2s ease-in-out infinite;
        transform-style: preserve-3d;
    }
    
    .crystal::before {
        content: '';
        position: absolute;
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        background: linear-gradient(45deg, var(--primary), transparent, var(--secondary));
        border-radius: 30px;
        filter: blur(15px);
        opacity: 0.5;
        z-index: -1;
    }
    
    @keyframes crystalFloat {
        0%, 100% { 
            transform: translateY(0) rotateX(0) rotateY(0); 
            border-radius: 20px;
        }
        25% { 
            transform: translateY(-15px) rotateX(15deg) rotateY(15deg); 
            border-radius: 30px 20px 30px 20px;
        }
        50% { 
            transform: translateY(-5px) rotateX(-10deg) rotateY(-10deg); 
            border-radius: 20px 30px 20px 30px;
        }
        75% { 
            transform: translateY(-10px) rotateX(5deg) rotateY(5deg); 
            border-radius: 25px;
        }
    }
    
    @keyframes crystalGlow {
        0%, 100% { 
            box-shadow: 
                0 0 20px rgba(138, 43, 226, 0.5),
                0 0 40px rgba(0, 191, 255, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
        }
        50% { 
            box-shadow: 
                0 0 30px rgba(138, 43, 226, 0.8),
                0 0 60px rgba(0, 191, 255, 0.5),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
        }
    }
    
    .loader p {
        font-size: 18px;
        color: var(--secondary);
        text-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
        animation: textPulse 2s ease-in-out infinite;
        font-weight: 600;
        letter-spacing: 1px;
    }
    
    @keyframes textPulse {
        0%, 100% { opacity: 0.7; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.05); }
    }
    
    /* Основной интерфейс */
    #main-ui {
        display: none;
        opacity: 0;
        animation: fadeIn 0.5s ease-out 0.3s forwards;
    }
    
    @keyframes fadeIn {
        to { opacity: 1; }
    }
    
    /* Навигация */
    .top-bar {
        background: rgba(15, 15, 30, 0.95);
        backdrop-filter: blur(20px) saturate(180%);
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
    }
    
    .player-info {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    #player-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--light);
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
    
    .mana-display {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 20px;
        font-weight: 700;
        padding: 8px 15px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        border: 2px solid rgba(0, 191, 255, 0.3);
        box-shadow: inset 0 0 15px rgba(0, 191, 255, 0.1),
                    0 5px 15px rgba(0, 191, 255, 0.2);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .mana-display::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(0, 191, 255, 0.2), transparent);
        animation: manaShine 3s ease-in-out infinite;
    }
    
    @keyframes manaShine {
        to { left: 100%; }
    }
    
    .mana-icon {
        color: var(--secondary);
        font-size: 24px;
        animation: manaPulse 2s ease-in-out infinite;
        filter: drop-shadow(0 0 8px currentColor);
    }
    
    @keyframes manaPulse {
        0%, 100% { 
            transform: scale(1) rotate(0deg);
            filter: drop-shadow(0 0 8px var(--secondary));
        }
        50% { 
            transform: scale(1.2) rotate(180deg);
            filter: drop-shadow(0 0 15px var(--secondary));
        }
    }
    
    .nav-buttons {
        display: flex;
        gap: 12px;
    }
    
    .nav-btn {
        width: 55px;
        height: 55px;
        border: none;
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.08);
        color: var(--light);
        font-size: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .nav-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
    }
    
    .nav-btn span {
        position: relative;
        z-index: 2;
    }
    
    .nav-btn.active {
        background: rgba(138, 43, 226, 0.3);
        transform: translateY(-5px) scale(1.1);
        box-shadow: 
            0 8px 25px rgba(138, 43, 226, 0.4),
            0 0 0 2px rgba(0, 191, 255, 0.3);
    }
    
    .nav-btn.active::before {
        opacity: 0.3;
    }
    
    .nav-btn:active {
        transform: scale(0.95);
    }
    
    .nav-btn:hover:not(.active) {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }
    
    .nav-btn::after {
        content: '';
        position: absolute;
        bottom: 5px;
        left: 50%;
        transform: translateX(-50%) scale(0);
        width: 6px;
        height: 6px;
        background: var(--secondary);
        border-radius: 50%;
        transition: transform 0.3s ease;
    }
    
    .nav-btn.active::after {
        transform: translateX(-50%) scale(1);
    }
    
    /* Контент */
    #content {
        padding: 25px 20px;
        min-height: calc(100vh - 110px);
        animation: slideUp 0.5s ease-out;
    }
    
    @keyframes slideUp {
        from { 
            opacity: 0;
            transform: translateY(20px);
        }
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Страница башни */
    .tower-page {
        text-align: center;
        animation: pageAppear 0.4s ease-out;
    }
    
    @keyframes pageAppear {
        from { 
            opacity: 0;
            transform: scale(0.95);
        }
        to { 
            opacity: 1;
            transform: scale(1);
        }
    }
    
    .tower-page h2 {
        font-size: 28px;
        margin-bottom: 15px;
        background: linear-gradient(45deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        font-weight: 800;
        text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        letter-spacing: 0.5px;
    }
    
    .level-info {
        font-size: 16px;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .level-badge {
        background: linear-gradient(45deg, var(--primary), var(--secondary));
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 14px;
        box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3);
        animation: badgeGlow 3s ease-in-out infinite;
    }
    
    @keyframes badgeGlow {
        0%, 100% { box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3); }
        50% { box-shadow: 0 4px 25px rgba(138, 43, 226, 0.6); }
    }
    
    .tap-area {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 30px;
        padding: 40px 25px;
        margin: 25px 0 35px;
        border: 2px solid transparent;
        background-clip: padding-box;
        position: relative;
        cursor: pointer;
        touch-action: manipulation;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        box-shadow: 
            0 10px 40px rgba(0, 0, 0, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .tap-area::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, var(--primary), var(--secondary), var(--primary));
        border-radius: 32px;
        z-index: -1;
        opacity: 0;
        transition: opacity 0.3s ease;
        animation: borderRotate 3s linear infinite;
        background-size: 400% 400%;
    }
    
    @keyframes borderRotate {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    
    .tap-area:hover::before {
        opacity: 1;
    }
    
    .tap-area:active {
        transform: scale(0.97);
        background: rgba(0, 191, 255, 0.05);
    }
    
    .tap-area:active .wizard-avatar {
        transform: scale(0.95);
    }
    
    .wizard-avatar {
        width: 140px;
        height: 140px;
        margin: 0 auto 25px;
        background: linear-gradient(45deg, var(--primary), var(--secondary));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 70px;
        position: relative;
        animation: wizardFloat 4s ease-in-out infinite;
        box-shadow: 
            0 20px 60px rgba(138, 43, 226, 0.4),
            inset 0 0 30px rgba(255, 255, 255, 0.2);
        transition: transform 0.2s ease;
    }
    
    .wizard-avatar::before {
        content: '';
        position: absolute;
        top: -10px;
        left: -10px;
        right: -10px;
        bottom: -10px;
        background: linear-gradient(45deg, var(--primary), transparent, var(--secondary));
        border-radius: 50%;
        filter: blur(25px);
        opacity: 0.5;
        z-index: -1;
        animation: auraPulse 4s ease-in-out infinite;
    }
    
    @keyframes wizardFloat {
        0%, 100% { 
            transform: translateY(0) rotate(0deg);
            box-shadow: 
                0 20px 60px rgba(138, 43, 226, 0.4),
                inset 0 0 30px rgba(255, 255, 255, 0.2);
        }
        25% { 
            transform: translateY(-15px) rotate(5deg);
            box-shadow: 
                0 25px 70px rgba(138, 43, 226, 0.5),
                inset 0 0 40px rgba(255, 255, 255, 0.3);
        }
        50% { 
            transform: translateY(-5px) rotate(-5deg);
            box-shadow: 
                0 15px 50px rgba(138, 43, 226, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.1);
        }
        75% { 
            transform: translateY(-10px) rotate(2deg);
            box-shadow: 
                0 22px 65px rgba(138, 43, 226, 0.45),
                inset 0 0 35px rgba(255, 255, 255, 0.25);
        }
    }
    
    @keyframes auraPulse {
        0%, 100% { 
            opacity: 0.4;
            transform: scale(0.95);
        }
        50% { 
            opacity: 0.7;
            transform: scale(1.05);
        }
    }
    
    .tap-hint {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--light);
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        letter-spacing: 0.5px;
    }
    
    .tap-reward {
        font-size: 16px;
        color: var(--secondary);
        font-weight: 500;
        opacity: 0.9;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .tap-reward::before {
        content: '⚡';
        animation: rewardFlash 2s ease-in-out infinite;
    }
    
    @keyframes rewardFlash {
        0%, 100% { opacity: 0.7; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.3); }
    }
    
    /* Кнопки */
    .btn {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border: none;
        border-radius: 18px;
        padding: 18px 30px;
        font-size: 18px;
        font-weight: 700;
        cursor: pointer;
        margin: 15px 0;
        width: 100%;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 
            0 10px 30px rgba(138, 43, 226, 0.4),
            0 5px 15px rgba(0, 0, 0, 0.2);
        letter-spacing: 0.5px;
        text-transform: uppercase;
        font-family: 'Segoe UI', sans-serif;
    }
    
    .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.6s ease;
    }
    
    .btn:hover::before {
        left: 100%;
    }
    
    .btn:hover {
        transform: translateY(-5px);
        box-shadow: 
            0 15px 40px rgba(138, 43, 226, 0.6),
            0 8px 25px rgba(0, 0, 0, 0.3);
    }
    
    .btn:active {
        transform: translateY(-2px) scale(0.98);
        box-shadow: 
            0 8px 25px rgba(138, 43, 226, 0.4),
            0 4px 15px rgba(0, 0, 0, 0.2);
    }
    
    .btn-secondary {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        border: 2px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }
    
    .btn-secondary:hover {
        border-color: var(--secondary);
        box-shadow: 0 10px 30px rgba(0, 191, 255, 0.3);
    }
    
    .btn-premium {
        background: linear-gradient(135deg, #ffd700, #ff8c00);
        box-shadow: 0 10px 30px rgba(255, 215, 0, 0.4);
    }
    
    .btn-premium:hover {
        box-shadow: 0 15px 40px rgba(255, 215, 0, 0.6);
    }
    
    .btn-premium::after {
        content: '⭐';
        position: absolute;
        right: 20px;
        animation: starTwinkle 1.5s ease-in-out infinite;
    }
    
    @keyframes starTwinkle {
        0%, 100% { opacity: 0.7; transform: scale(1) rotate(0deg); }
        50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
    }
    
    /* Флоатинги */
    .floating-text {
        position: fixed;
        color: var(--secondary);
        font-weight: 800;
        font-size: 32px;
        pointer-events: none;
        z-index: 1000;
        text-shadow: 
            0 0 20px var(--secondary),
            0 0 40px rgba(0, 191, 255, 0.5),
            0 0 60px rgba(0, 191, 255, 0.3);
        animation: floatUp 1.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        left: 50%;
        top: 40%;
        transform: translateX(-50%);
        font-family: 'Segoe UI', monospace;
        letter-spacing: 1px;
    }
    
    @keyframes floatUp {
        0% {
            transform: translateY(0) translateX(-50%) scale(0.8);
            opacity: 0;
            filter: blur(5px);
        }
        20% {
            transform: translateY(-30px) translateX(-50%) scale(1.3);
            opacity: 1;
            filter: blur(0);
        }
        80% {
            transform: translateY(-150px) translateX(-50%) scale(1);
            opacity: 1;
            filter: blur(0);
        }
        100% {
            transform: translateY(-200px) translateX(-50%) scale(0.5);
            opacity: 0;
            filter: blur(10px);
        }
    }
    
    /* Анимация комбо */
    .combo-success {
        animation: comboExplosion 0.8s ease-out;
    }
    
    @keyframes comboExplosion {
        0% { transform: scale(0.5); opacity: 0; }
        50% { transform: scale(1.2); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
    }
    
    /* Уровень ап */
    .level-up-animation {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 60px;
        font-weight: 900;
        color: var(--success);
        text-shadow: 
            0 0 30px var(--success),
            0 0 60px rgba(0, 255, 136, 0.5);
        animation: levelUpAnim 1.5s ease-out forwards;
        z-index: 1001;
        pointer-events: none;
        text-align: center;
        white-space: nowrap;
    }
    
    @keyframes levelUpAnim {
        0% {
            transform: translate(-50%, -50%) scale(0.2) rotate(-30deg);
            opacity: 0;
            filter: blur(20px);
        }
        20% {
            transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
            opacity: 1;
            filter: blur(0);
        }
        40% {
            transform: translate(-50%, -50%) scale(1) rotate(0deg);
            opacity: 1;
            filter: blur(0);
        }
        60% {
            transform: translate(-50%, -50%) scale(1.1) rotate(5deg);
            opacity: 1;
            filter: blur(0);
        }
        80% {
            transform: translate(-50%, -50%) scale(1) rotate(0deg);
            opacity: 1;
            filter: blur(0);
        }
        100% {
            transform: translate(-50%, -50%) scale(1.5) rotate(10deg);
            opacity: 0;
            filter: blur(10px);
        }
    }
    
    /* Показываем/скрываем */
    .show {
        display: block !important;
        animation: fadeInUp 0.5s ease-out;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .hide {
        display: none !important;
        animation: fadeOut 0.3s ease-out;
    }
    
    @keyframes fadeOut {
        from {
            opacity: 1;
            transform: scale(1);
        }
        to {
            opacity: 0;
            transform: scale(0.95);
        }
    }
    
    /* Адаптивность */
    @media (max-width: 480px) {
        .nav-btn {
            width: 50px;
            height: 50px;
            font-size: 22px;
        }
        
        .wizard-avatar {
            width: 120px;
            height: 120px;
            font-size: 60px;
        }
        
        .btn {
            padding: 16px 25px;
            font-size: 16px;
        }
        
        .mana-display {
            font-size: 18px;
            padding: 6px 12px;
        }
        
        .floating-text {
            font-size: 28px;
        }
        
        .level-up-animation {
            font-size: 50px;
        }
    }
    
    @media (max-width: 360px) {
        .nav-btn {
            width: 45px;
            height: 45px;
            font-size: 20px;
        }
        
        .wizard-avatar {
            width: 100px;
            height: 100px;
            font-size: 50px;
        }
        
        .top-bar {
            padding: 12px 15px;
        }
        
        #content {
            padding: 20px 15px;
        }
    }
</style>
