document.addEventListener('DOMContentLoaded', () => {
    initApp();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    loadTowerPage();
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è
    setupNavigation();
    
    // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('main-ui').classList.remove('hidden');
    }, 1000);
});

function initApp() {
    console.log("–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");
}

function loadTowerPage() {
    const content = document.getElementById('content');
    
    content.innerHTML = `
        <div class="tower-page">
            <h2>üè∞ –ú–∞–≥–∏—á–µ—Å–∫–∞—è –ë–∞—à–Ω—è</h2>
            <p>–£—Ä–æ–≤–µ–Ω—å: <strong>${Game.level}</strong></p>
            
            <div class="tap-area">
                <div class="wizard-avatar">
                    üßô
                </div>
                <p>–¢–∞–ø–∞–π –ø–æ –º–∞–≥—É –¥–ª—è —Å–±–æ—Ä–∞ –º–∞–Ω—ã!</p>
            </div>
            
            <div class="daily-section">
                <h3>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –∫–æ–º–±–æ</h3>
                <input type="text" 
                       id="combo-input" 
                       placeholder="–í–≤–µ–¥–∏ ALT+MANA"
                       maxlength="20">
                <button class="btn" id="combo-btn">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–±–æ</button>
                <p class="combo-hint">–î–∞–µ—Ç +${CONFIG.GAME.DAILY_COMBO_REWARD} –º–∞–Ω—ã —Ä–∞–∑ –≤ –¥–µ–Ω—å</p>
            </div>
            
            <div class="stats">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <p>–ú–∞–Ω—É –º–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π</p>
                <button class="btn" id="test-btn">–¢–µ—Å—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞</button>
            </div>
        </div>
    `;
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const tapArea = document.querySelector('.tap-area');
    const comboBtn = document.getElementById('combo-btn');
    const comboInput = document.getElementById('combo-input');
    
    if (tapArea) {
        tapArea.addEventListener('click', () => Game.tap());
        tapArea.addEventListener('touchstart', (e) => {
            e.preventDefault();
            Game.tap();
        });
    }
    
    if (comboBtn) {
        comboBtn.addEventListener('click', () => {
            if (comboInput.value) {
                Game.useDailyCombo(comboInput.value);
                comboInput.value = '';
            }
        });
    }
}

function setupNavigation() {
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const page = e.target.dataset.page;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            if (page === 'tower') {
                loadTowerPage();
            } else {
                // –í—Ä–µ–º–µ–Ω–Ω–æ: –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
                document.getElementById('content').innerHTML = `
                    <div style="text-align: center; padding: 50px 20px;">
                        <h2>‚è≥ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h2>
                        <p>${page === 'spells' ? 'üìñ –ó–∞–∫–ª–∏–Ω–∞–Ω–∏—è' : 
                           page === 'duel' ? '‚öîÔ∏è –î—É—ç–ª–∏' : 
                           'üë• –ì–∏–ª—å–¥–∏—è'} —Å–∫–æ—Ä–æ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã!</p>
                        <button class="btn" onclick="loadTowerPage()">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–∞—à–Ω—é</button>
                    </div>
                `;
            }
        });
    });
}

// –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
const style = document.createElement('style');
style.textContent = `
    @keyframes floatUp {
        0% { transform: translateY(0) translateX(-50%); opacity: 1; }
        100% { transform: translateY(-100px) translateX(-50%); opacity: 0; }
    }
    
    .floating-text {
        transform: translateX(-50%);
    }
`;
document.head.appendChild(style);
